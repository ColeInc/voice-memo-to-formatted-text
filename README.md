# Voice Memo Transcription System

Automated audio transcription service using OpenAI Whisper. Monitors an input directory for audio files, transcribes them, and outputs formatted transcripts with email error notifications.

## Features

- **Automatic Processing**: Polls INPUT directory every 10 seconds
- **Multiple Formats**: Supports mp3, m4a, wav, flac, ogg, aac, wma, mp4
- **High Accuracy**: Uses OpenAI Whisper large model
- **Error Handling**: Email notifications for processing errors
- **File Management**: Moves processed files to organized storage
- **Comprehensive Logging**: Detailed logs of all operations
- **Timestamped Output**: Transcript files with creation timestamps

## Setup

### 1. Install Dependencies

```bash
pip install -r requirements.txt
```

Note: First installation may take several minutes as Whisper downloads the large model (~3GB).

### 2. Configure Email (Optional but Recommended)

Edit `config.py` and set your email credentials:

```python
EMAIL_CONFIG = {
    'sender_email': 'your-email@gmail.com',
    'sender_password': 'your-app-password',  # Use Gmail App Password, not regular password
    # ... other settings remain the same
}
```

**Gmail App Password Setup:**
1. Enable 2-Factor Authentication on your Gmail account
2. Go to Google Account settings → Security → App passwords
3. Generate an app password for this application
4. Use the generated password (not your regular Gmail password)

### 3. SSL Certificate Issues (Corporate Networks)

If you encounter SSL certificate errors during model download:

```bash
CERTIFICATE_VERIFY_FAILED: certificate verify failed: self-signed certificate
```

This is common on corporate networks with SSL inspection. To fix:

1. Edit `config.py` and set:
```python
SSL_VERIFY = False  # Reduces security but allows the script to work
```

2. Alternatively, configure your certificates properly (recommended for production)

### 4. Directory Structure

The system automatically creates these directories:
- `INPUT/` - Drop audio files here
- `OUTPUT/` - Transcripts are saved here
- `INPUT/processed/` - Processed audio files are moved here

## Usage

### Start the Service

#### Manual Start
```bash
python3 transcribe_audio.py
```

The service will:
1. Start monitoring the INPUT directory
2. Process any existing audio files
3. Continue monitoring for new files every 10 seconds

#### Automatic Startup (Run at Boot)

**macOS:** Use the provided installation script:
```bash
./install_service.sh
```

This will:
- Install a launchd service that starts at login
- Run the transcriber continuously in the background
- Create log files for monitoring

To uninstall:
```bash
./uninstall_service.sh
```

**Linux:** See `LINUX_SETUP.md` for systemd service configuration.

**Windows:** Use Task Scheduler to run the script at startup (see troubleshooting section).

### Process Audio Files

1. Drop audio files into the `INPUT/` directory
2. Files are processed automatically in chronological order
3. Transcripts appear in `OUTPUT/` directory with timestamps
4. Original files are moved to `INPUT/processed/`

### Output Format

Transcript files are named: `YYYYMMDD_HHMMSS_original-filename_transcript.txt`

Example content:
```
Voice Memo Transcript
======================

Original File: my-recording.m4a
Transcription Date: 2024-12-15 14:30:22
Model Used: large

Transcript:
-----------

[Your transcribed audio content here]

---
Generated by Voice Memo Transcription System
```

## Configuration

Edit `config.py` to customize:

- **Whisper Model**: Change `WHISPER_MODEL` (tiny, base, small, medium, large)
- **Poll Interval**: Adjust `POLL_INTERVAL` (seconds between directory checks)
- **Supported Formats**: Modify `SUPPORTED_FORMATS` set
- **Email Settings**: Configure error notifications
- **Logging Level**: Adjust logging verbosity

## Monitoring and Logs

### Log File
All operations are logged to `transcription.log` with timestamps.

### Console Output
Real-time status updates are displayed in the terminal.

### Error Notifications
Processing errors automatically trigger email notifications to `colehmcconnell@gmail.com`.

## Troubleshooting

### Common Issues

**"OpenAI Whisper not installed"**
```bash
pip install -r requirements.txt
```

**SSL Certificate Errors**
```
CERTIFICATE_VERIFY_FAILED: certificate verify failed: self-signed certificate
```
- Edit `config.py` and set `SSL_VERIFY = False`
- This commonly occurs on corporate networks with SSL inspection
- Alternative: Configure proper certificates (more secure)

**"CUDA out of memory" (if using GPU)**
- Switch to a smaller model (medium, small, base, tiny) in `config.py`
- Or add CPU-only processing: `pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cpu`

**Email notifications not working**
- Check Gmail App Password setup
- Verify email credentials in `config.py`
- Check firewall/network settings

**Files not being processed**
- Ensure files are in supported formats
- Check file permissions
- Monitor `transcription.log` for errors

**Service not starting automatically (macOS)**
- Check if the service is loaded: `launchctl list | grep voicememo`
- View service logs: `tail -f launchd.log` and `tail -f launchd_error.log`
- Reinstall service: `./uninstall_service.sh` then `./install_service.sh`
- Check file permissions on the project directory

**Windows Startup Setup**
Create a batch file `start_transcriber.bat`:
```batch
@echo off
cd /d "C:\path\to\your\project"
python transcribe_audio.py
```
Then add this batch file to Windows Task Scheduler with "Run at startup" trigger.

### Performance

- **Large Model**: Most accurate, ~3GB RAM, slower processing
- **Medium Model**: Good balance, ~1.5GB RAM, faster
- **Small Model**: Fast processing, less accurate
- **Processing Speed**: ~1-4x real-time depending on model and hardware

## Stopping the Service

Press `Ctrl+C` to gracefully stop the service. Current file processing will complete before shutdown.

## Security Notes

- Audio files and transcripts are stored locally only
- Email credentials should use App Passwords, not main passwords
- All file operations include error handling and logging